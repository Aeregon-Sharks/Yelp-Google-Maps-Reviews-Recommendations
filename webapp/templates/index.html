<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebApp Yelp-GGMaps</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>WebApp Yelp-GGMaps</h1>
  </header>
  <main>
    <section class="login">
      {% if logged_in %}
        <h2>Bienvenido</h2>
        <p>Para subir un archivo, selecciona la carpeta y el archivo a reemplazar. Ten en cuenta que el archivo seleccionado será reemplazado.</p>
      {% else %}
        <h2>Iniciar Sesión</h2>
        <form action="/login" method="post">
          <label for="usuario">Usuario:</label>
          <input type="text" id="usuario" name="usuario" required>
          <label for="contrasena">Contraseña:</label>
          <input type="password" id="contrasena" name="contrasena" required>
          <button type="submit">Iniciar Sesión</button>
        </form>
      {% endif %}
    </section>
    <section class="upload">
      {% if logged_in %}
        <h2>Subir Archivo</h2>
        <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
          <label for="archivo">Seleccionar Archivo:</label>
          <input type="file" id="archivo" name="archivo" required>
          <label for="carpeta">Seleccionar Carpeta:</label>
          <select id="carpeta" name="carpeta" required></select>
          <label for="archivo_a_reemplazar">Seleccionar Archivo a Reemplazar:</label>
          <select id="archivo_a_reemplazar" name="archivo_a_reemplazar" required></select>
          <button type="submit">Subir Archivo</button>
        </form>
      {% endif %}
    </section>
  </main>
  <footer>
    <p>Copyright &copy; 2024</p>
  </footer>

  <script>
    // Función para cargar las carpetas en el formulario
    function loadFolders() {
      fetch('/get_folders')
        .then(response => response.json())
        .then(data => {
          const folderSelect = document.getElementById('carpeta');
          folderSelect.innerHTML = '';
          data.folders.forEach(folder => {
            const option = document.createElement('option');
            option.value = folder;
            option.textContent = folder;
            folderSelect.appendChild(option);
          });

          // Llamar a la función para cargar los archivos
          loadFiles();
        });
    }

    // Función para cargar los archivos en el formulario
    function loadFiles() {
      const selectedFolder = document.getElementById('carpeta').value;
      fetch('/get_files', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ folder: selectedFolder }),
      })
        .then(response => response.json())
        .then(data => {
          const fileSelect = document.getElementById('archivo_a_reemplazar');
          fileSelect.innerHTML = '';
          data.files.forEach(file => {
            const option = document.createElement('option');
            option.value = file;
            option.textContent = file;
            fileSelect.appendChild(option);
          });
        });
    }

    // Llamar a la función para cargar las carpetas al cargar la página
    loadFolders();

    // Agregar un evento para cargar los archivos cuando se cambia la carpeta seleccionada
    document.getElementById('carpeta').addEventListener('change', loadFiles);
  </script>
</body>
</html>